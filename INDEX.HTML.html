<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Center ‚Äî An√°lise L√©xico-Sem√¢ntica | Cabo Frio - RJ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
  <style>
    :root {
      --bg: #0f1117;
      --surface: #1a1d27;
      --surface2: #22263a;
      --border: #2e3350;
      --accent: #6c63ff;
      --accent2: #00d4aa;
      --accent3: #ff6b6b;
      --accent4: #ffd166;
      --accent5: #a8dadc;
      --text: #e8eaf6;
      --text-muted: #8892b0;
      --positive: #00d4aa;
      --negative: #ff6b6b;
      --neutral: #8892b0;
      --mixed: #ffd166;
      --ironic: #c77dff;
      --approval: #00d4aa;
      --disapproval: #ff6b6b;
      --radius: 14px;
      --shadow: 0 4px 24px rgba(0,0,0,0.4);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    header {
      background: linear-gradient(135deg, #1a1d27 0%, #0f1117 100%);
      border-bottom: 1px solid var(--border);
      padding: 28px 40px 24px;
      position: sticky; top: 0; z-index: 100;
      backdrop-filter: blur(12px);
    }
    .header-inner { max-width: 1600px; margin: 0 auto; }
    .header-top { display: flex; align-items: center; gap: 16px; flex-wrap: wrap; }
    .logo-badge {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-radius: 10px; padding: 8px 14px;
      font-size: 12px; font-weight: 700; letter-spacing: 1.5px;
      text-transform: uppercase; color: #fff;
    }
    header h1 { font-size: 1.4rem; font-weight: 700; color: var(--text); }
    header p { font-size: 0.85rem; color: var(--text-muted); margin-top: 6px; }
    .header-meta { display: flex; gap: 20px; margin-top: 12px; flex-wrap: wrap; }
    .meta-chip {
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 20px; padding: 4px 12px;
      font-size: 0.78rem; color: var(--text-muted);
    }
    .meta-chip strong { color: var(--accent2); }

    /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
    main { max-width: 1600px; margin: 0 auto; padding: 32px 24px 60px; }

    /* ‚îÄ‚îÄ Section titles ‚îÄ‚îÄ */
    .section-title {
      font-size: 0.7rem; font-weight: 700; letter-spacing: 2px;
      text-transform: uppercase; color: var(--accent);
      margin-bottom: 16px; display: flex; align-items: center; gap: 8px;
    }
    .section-title::after {
      content: ''; flex: 1; height: 1px; background: var(--border);
    }

    /* ‚îÄ‚îÄ KPI Cards ‚îÄ‚îÄ */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px; margin-bottom: 32px;
    }
    .kpi-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px 22px;
      position: relative; overflow: hidden;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .kpi-card:hover { transform: translateY(-2px); box-shadow: var(--shadow); }
    .kpi-card::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
    }
    .kpi-card.accent::before { background: linear-gradient(90deg, var(--accent), var(--accent2)); }
    .kpi-card.negative::before { background: var(--negative); }
    .kpi-card.positive::before { background: var(--positive); }
    .kpi-card.neutral::before { background: var(--neutral); }
    .kpi-card.warning::before { background: var(--accent4); }
    .kpi-card.purple::before { background: var(--ironic); }
    .kpi-label { font-size: 0.72rem; color: var(--text-muted); letter-spacing: 0.5px; text-transform: uppercase; }
    .kpi-value { font-size: 2rem; font-weight: 800; margin: 6px 0 2px; line-height: 1; }
    .kpi-sub { font-size: 0.75rem; color: var(--text-muted); }

    /* ‚îÄ‚îÄ Chart Grid ‚îÄ‚îÄ */
    .chart-grid-2 {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(480px, 1fr));
      gap: 20px; margin-bottom: 28px;
    }
    .chart-grid-3 {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
      gap: 20px; margin-bottom: 28px;
    }
    .chart-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 22px 24px;
      box-shadow: var(--shadow);
    }
    .chart-card h3 {
      font-size: 0.88rem; font-weight: 600; color: var(--text);
      margin-bottom: 4px;
    }
    .chart-card p {
      font-size: 0.75rem; color: var(--text-muted); margin-bottom: 16px;
    }
    .chart-wrap { position: relative; height: 350px; }

    /* ‚îÄ‚îÄ Word Cloud ‚îÄ‚îÄ */
    .wordcloud-wrap {
      display: flex; flex-wrap: wrap; gap: 8px;
      align-items: center; padding: 12px 0;
      max-height: 320px; overflow-y: auto;
    }
    .word-tag {
      border-radius: 6px; padding: 4px 10px;
      cursor: default; transition: transform 0.15s;
      font-weight: 600; white-space: nowrap;
    }
    .word-tag:hover { transform: scale(1.08); }

    /* ‚îÄ‚îÄ Table ‚îÄ‚îÄ */
    .table-wrap { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 0.82rem; }
    th {
      background: var(--surface2); color: var(--text-muted);
      font-size: 0.7rem; font-weight: 700; letter-spacing: 1px;
      text-transform: uppercase; padding: 10px 14px; text-align: left;
      border-bottom: 1px solid var(--border);
    }
    td { padding: 10px 14px; border-bottom: 1px solid var(--border); vertical-align: top; }
    tr:last-child td { border-bottom: none; }
    tr:hover td { background: var(--surface2); }
    .badge {
      display: inline-block; border-radius: 20px;
      padding: 2px 10px; font-size: 0.72rem; font-weight: 700;
    }
    .badge-neg { background: rgba(255,107,107,0.15); color: var(--negative); }
    .badge-pos { background: rgba(0,212,170,0.15); color: var(--positive); }
    .badge-neu { background: rgba(136,146,176,0.15); color: var(--neutral); }
    .badge-mix { background: rgba(255,209,102,0.15); color: var(--mixed); }
    .badge-iro { background: rgba(199,125,255,0.15); color: var(--ironic); }

    /* ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ */
    .tab-bar { display: flex; gap: 6px; margin-bottom: 16px; flex-wrap: wrap; }
    .tab-btn {
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 8px; padding: 6px 14px;
      font-size: 0.78rem; font-weight: 600; cursor: pointer;
      color: var(--text-muted); transition: all 0.2s;
    }
    .tab-btn:hover, .tab-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* ‚îÄ‚îÄ Comment cards ‚îÄ‚îÄ */
    .comment-list { display: flex; flex-direction: column; gap: 12px; max-height: 600px; overflow-y: auto; }
    .comment-card {
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 10px; padding: 14px 16px;
    }
    .comment-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
    .comment-avatar {
      width: 32px; height: 32px; border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      display: flex; align-items: center; justify-content: center;
      font-size: 0.75rem; font-weight: 700; color: #fff; flex-shrink: 0;
    }
    .comment-user { font-size: 0.82rem; font-weight: 600; flex: 1; }
    .comment-meta { font-size: 0.72rem; color: var(--text-muted); }
    .comment-text { font-size: 0.85rem; line-height: 1.5; color: var(--text); margin-bottom: 8px; }
    .comment-footer { display: flex; gap: 8px; flex-wrap: wrap; }

    /* ‚îÄ‚îÄ Location bars ‚îÄ‚îÄ */
    .location-bars { display: flex; flex-direction: column; gap: 8px; }
    .loc-row { display: flex; align-items: center; gap: 10px; }
    .loc-name { font-size: 0.8rem; min-width: 160px; color: var(--text); font-weight: 500; }
    .loc-bar-wrap { flex: 1; background: var(--surface2); border-radius: 4px; height: 10px; overflow: hidden; }
    .loc-bar { height: 100%; border-radius: 4px; background: linear-gradient(90deg, var(--accent), var(--accent2)); transition: width 0.8s ease; }
    .loc-count { font-size: 0.78rem; color: var(--text-muted); min-width: 40px; text-align: right; }

    /* ‚îÄ‚îÄ Insight box ‚îÄ‚îÄ */
    .insight-box {
      background: linear-gradient(135deg, rgba(108,99,255,0.1), rgba(0,212,170,0.05));
      border: 1px solid rgba(108,99,255,0.3);
      border-radius: var(--radius); padding: 16px 20px;
      margin-bottom: 28px;
    }
    .insight-box h4 { font-size: 0.82rem; color: var(--accent); margin-bottom: 8px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
    .insight-box p { font-size: 0.85rem; color: var(--text-muted); line-height: 1.6; }
    .insight-box strong { color: var(--text); }

    /* ‚îÄ‚îÄ Alert box ‚îÄ‚îÄ */
    .alert-box {
      background: rgba(255,107,107,0.1);
      border: 1px solid rgba(255,107,107,0.3);
      border-left: 4px solid var(--negative);
      border-radius: var(--radius);
      padding: 16px 20px;
      margin-bottom: 16px;
    }
    .alert-title { font-weight: 700; color: var(--negative); margin-bottom: 6px; font-size: 0.82rem; text-transform: uppercase; letter-spacing: 1px; }

    /* ‚îÄ‚îÄ Search ‚îÄ‚îÄ */
    .search-box {
      width: 100%;
      padding: 12px 16px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 0.85rem;
      margin-bottom: 16px;
      font-family: inherit;
    }
    .search-box:focus {
      outline: none;
      border-color: var(--accent);
    }

    /* ‚îÄ‚îÄ Scrollbar ‚îÄ‚îÄ */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: var(--surface); }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

    /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
    @media (max-width: 768px) {
      header { padding: 20px 16px; }
      main { padding: 20px 12px 40px; }
      .chart-grid-2, .chart-grid-3 { grid-template-columns: 1fr; }
      .kpi-grid { grid-template-columns: repeat(2, 1fr); }
    }

    /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
    footer {
      text-align: center; padding: 24px;
      font-size: 0.75rem; color: var(--text-muted);
      border-top: 1px solid var(--border);
      margin-top: 40px;
    }
  </style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="header-top">
      <span class="logo-badge">Data Center</span>
      <div>
        <h1>An√°lise L√©xico-Sem√¢ntica ‚Äî Taxa do Lixo</h1>
        <p>Padr√µes de sentimento, localiza√ß√£o e aprova√ß√£o em coment√°rios de redes sociais | Cabo Frio - RJ</p>
      </div>
    </div>
    <div class="header-meta" id="header-meta">
      <span class="meta-chip">Total: <strong>0 coment√°rios</strong></span>
      <span class="meta-chip">Per√≠odo: <strong>Fevereiro 2026</strong></span>
      <span class="meta-chip">Fontes: <strong>Instagram + Facebook</strong></span>
      <span class="meta-chip">Status: <strong>An√°lise Conclu√≠da</strong></span>
    </div>
  </div>
</header>

<main>

  <!-- ‚îÄ‚îÄ KPIs ‚îÄ‚îÄ -->
  <div class="section-title">Indicadores Gerais</div>
  <div class="kpi-grid">
    <div class="kpi-card accent">
      <div class="kpi-label">Total de Coment√°rios</div>
      <div class="kpi-value" style="color:var(--accent2)" id="kpi-total">0</div>
      <div class="kpi-sub">5 fontes analisadas</div>
    </div>
    <div class="kpi-card negative">
      <div class="kpi-label">Sentimento Negativo</div>
      <div class="kpi-value" style="color:var(--negative)" id="kpi-negative">0%</div>
      <div class="kpi-sub"><span id="kpi-negative-count">0</span> coment√°rios</div>
    </div>
    <div class="kpi-card neutral">
      <div class="kpi-label">Sentimento Neutro</div>
      <div class="kpi-value" style="color:var(--neutral)" id="kpi-neutral">0%</div>
      <div class="kpi-sub"><span id="kpi-neutral-count">0</span> coment√°rios</div>
    </div>
    <div class="kpi-card positive">
      <div class="kpi-label">Sentimento Positivo</div>
      <div class="kpi-value" style="color:var(--positive)" id="kpi-positive">0%</div>
      <div class="kpi-sub"><span id="kpi-positive-count">0</span> coment√°rios</div>
    </div>
    <div class="kpi-card purple">
      <div class="kpi-label">Ironia / Sarcasmo</div>
      <div class="kpi-value" style="color:var(--ironic)" id="kpi-ironic">0%</div>
      <div class="kpi-sub"><span id="kpi-ironic-count">0</span> detectados</div>
    </div>
    <div class="kpi-card warning">
      <div class="kpi-label">Alertas Cr√≠ticos</div>
      <div class="kpi-value" style="color:var(--accent4)" id="kpi-alerts">0</div>
      <div class="kpi-sub">Monitoramento ativo</div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Insight Box ‚îÄ‚îÄ -->
  <div class="insight-box">
    <h4>üéØ Resumo Executivo</h4>
    <p id="executive-summary">
      Carregando an√°lise...
    </p>
  </div>

  <!-- ‚îÄ‚îÄ Charts ‚îÄ‚îÄ -->
  <div class="section-title">An√°lise de Sentimentos</div>
  <div class="chart-grid-2">
    <div class="chart-card">
      <h3>Distribui√ß√£o de Sentimentos</h3>
      <p>An√°lise l√©xico-sem√¢ntica autom√°tica com detec√ß√£o de ironia</p>
      <div class="chart-wrap">
        <canvas id="sentiment-pie"></canvas>
      </div>
    </div>

    <div class="chart-card">
      <h3>√çndice de Risco Pol√≠tico</h3>
      <p>Avalia√ß√£o multidimensional do impacto eleitoral</p>
      <div class="chart-wrap">
        <canvas id="risk-radar"></canvas>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Locations ‚îÄ‚îÄ -->
  <div class="section-title">An√°lise Geogr√°fica</div>
  <div class="chart-grid-2">
    <div class="chart-card">
      <h3>Principais Localidades Mencionadas</h3>
      <p>Distribui√ß√£o geogr√°fica das men√ß√µes nos coment√°rios</p>
      <div class="chart-wrap">
        <canvas id="location-chart"></canvas>
      </div>
    </div>

    <div class="chart-card">
      <h3>Mapa de Calor por Bairro</h3>
      <p>Intensidade de men√ß√µes por regi√£o de Cabo Frio</p>
      <div class="location-bars" id="location-bars">
        <!-- Gerado dinamicamente -->
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Themes ‚îÄ‚îÄ -->
  <div class="section-title">Categoriza√ß√£o Tem√°tica</div>
  <div class="chart-grid-2">
    <div class="chart-card">
      <h3>Distribui√ß√£o de Temas</h3>
      <p>Principais assuntos identificados nos coment√°rios</p>
      <div class="chart-wrap">
        <canvas id="themes-chart"></canvas>
      </div>
    </div>

    <div class="chart-card">
      <h3>Palavras Mais Frequentes</h3>
      <p>Top 40 palavras-chave extra√≠das dos coment√°rios</p>
      <div class="wordcloud-wrap" id="wordcloud">
        <!-- Gerado dinamicamente -->
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Critical Alerts ‚îÄ‚îÄ -->
  <div class="section-title">üö® Alertas Cr√≠ticos</div>
  <div id="alerts-container">
    <!-- Gerado dinamicamente -->
  </div>

  <!-- ‚îÄ‚îÄ Top Comments ‚îÄ‚îÄ -->
  <div class="section-title">üí¨ Principais Coment√°rios</div>
  <div class="chart-card">
    <h3>Coment√°rios com Maior Engajamento</h3>
    <p>Ordenados por likes + replies</p>
    
    <div class="tab-bar">
      <button class="tab-btn active" onclick="filterComments('all')">Todos</button>
      <button class="tab-btn" onclick="filterComments('negativo')">Negativos</button>
      <button class="tab-btn" onclick="filterComments('positivo')">Positivos</button>
      <button class="tab-btn" onclick="filterComments('neutro')">Neutros</button>
    </div>

    <input type="text" class="search-box" id="search-comments" placeholder="üîç Buscar nos coment√°rios..." onkeyup="searchComments()">
    
    <div class="comment-list" id="comments-list">
      <!-- Gerado dinamicamente -->
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Insights Estrat√©gicos ‚îÄ‚îÄ -->
  <div class="section-title">üí° Insights Estrat√©gicos</div>
  <div class="chart-card">
    <h3>Recomenda√ß√µes e Plano de A√ß√£o</h3>
    <p>Baseado na an√°lise completa dos dados</p>
    <div id="strategic-insights">
      <!-- Gerado dinamicamente -->
    </div>
  </div>

</main>

<footer>
  <strong>SAGUI Data Center</strong> ‚Äî Sistema de Monitoramento de Redes Sociais | Cabo Frio - RJ<br>
  An√°lise L√©xico-Sem√¢ntica Automatizada ‚Ä¢ Fevereiro 2026
</footer>

<script>
  let reportData = null;
  let allComments = [];
  let currentFilter = 'all';

  // Load data
  async function loadData() {
    try {
      const response = await fetch('report_data.json');
      reportData = await response.json();
      allComments = reportData.all_comments || [];
      renderDashboard();
    } catch (error) {
      console.error('Erro ao carregar dados:', error);
    }
  }

  function renderDashboard() {
    if (!reportData) return;

    // Update KPIs
    updateKPIs();
    
    // Update header
    updateHeader();
    
    // Render charts
    renderSentimentPie();
    renderRiskRadar();
    renderLocationChart();
    renderLocationBars();
    renderThemesChart();
    renderWordCloud();
    renderAlerts();
    renderComments();
    renderStrategicInsights();
    renderExecutiveSummary();
  }

  function updateKPIs() {
    const total = reportData.total_comments;
    const sentiments = reportData.sentiments;

    document.getElementById('kpi-total').textContent = total.toLocaleString('pt-BR');
    
    const negPct = ((sentiments.negativo / total) * 100).toFixed(1);
    document.getElementById('kpi-negative').textContent = negPct + '%';
    document.getElementById('kpi-negative-count').textContent = sentiments.negativo;

    const neuPct = ((sentiments.neutro / total) * 100).toFixed(1);
    document.getElementById('kpi-neutral').textContent = neuPct + '%';
    document.getElementById('kpi-neutral-count').textContent = sentiments.neutro;

    const posPct = ((sentiments.positivo / total) * 100).toFixed(1);
    document.getElementById('kpi-positive').textContent = posPct + '%';
    document.getElementById('kpi-positive-count').textContent = sentiments.positivo;

    // Calcular ironia (coment√°rios que parecem positivos mas s√£o negativos)
    const ironicCount = allComments.filter(c => 
      c.text.toLowerCase().includes('parab√©ns') || 
      c.text.toLowerCase().includes('claro') ||
      c.text.toLowerCase().includes('com certeza')
    ).length;
    const ironicPct = ((ironicCount / total) * 100).toFixed(1);
    document.getElementById('kpi-ironic').textContent = ironicPct + '%';
    document.getElementById('kpi-ironic-count').textContent = ironicCount;

    const alertsCount = reportData.critical_alerts.length;
    document.getElementById('kpi-alerts').textContent = alertsCount;
  }

  function updateHeader() {
    document.getElementById('header-meta').innerHTML = `
      <span class="meta-chip">Total: <strong>${reportData.total_comments.toLocaleString('pt-BR')} coment√°rios</strong></span>
      <span class="meta-chip">Per√≠odo: <strong>Fevereiro 2026</strong></span>
      <span class="meta-chip">Fontes: <strong>Instagram + Facebook</strong></span>
      <span class="meta-chip">Status: <strong>An√°lise Conclu√≠da</strong></span>
    `;
  }

  function renderExecutiveSummary() {
    const total = reportData.total_comments;
    const negPct = ((reportData.sentiments.negativo / total) * 100).toFixed(1);
    const posPct = ((reportData.sentiments.positivo / total) * 100).toFixed(1);
    
    let status = '';
    let recommendation = '';
    
    if (negPct > 40) {
      status = '<strong style="color: var(--negative)">CR√çTICO</strong>';
      recommendation = 'A√ß√£o imediata necess√°ria. Alto risco pol√≠tico detectado.';
    } else if (negPct > 25) {
      status = '<strong style="color: var(--accent4)">ALERTA</strong>';
      recommendation = 'Monitoramento intensivo e a√ß√µes corretivas recomendadas.';
    } else {
      status = '<strong style="color: var(--positive)">EST√ÅVEL</strong>';
      recommendation = 'Situa√ß√£o sob controle. Manter monitoramento regular.';
    }

    document.getElementById('executive-summary').innerHTML = `
      Status da Crise: ${status} ‚Ä¢ 
      An√°lise de <strong>${total}</strong> coment√°rios revelou <strong>${negPct}%</strong> de sentimento negativo e apenas <strong>${posPct}%</strong> positivo. 
      ${recommendation}
      Principal tema: <strong>Taxa do Lixo</strong>. 
      Bairros mais afetados: <strong>${Object.keys(reportData.locations).filter(l => l !== 'N√£o especificado').slice(0, 3).join(', ')}</strong>.
    `;
  }

  function renderSentimentPie() {
    const ctx = document.getElementById('sentiment-pie').getContext('2d');
    const sentiments = reportData.sentiments;

    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Negativo', 'Neutro', 'Positivo'],
        datasets: [{
          data: [sentiments.negativo, sentiments.neutro, sentiments.positivo],
          backgroundColor: ['#ff6b6b', '#8892b0', '#00d4aa'],
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom',
            labels: { color: '#e8eaf6', padding: 15, font: { size: 12 } }
          },
          datalabels: {
            color: '#fff',
            font: { weight: 'bold', size: 14 },
            formatter: (value, ctx) => {
              const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
              const percentage = ((value / total) * 100).toFixed(1);
              return percentage + '%';
            }
          }
        }
      }
    });
  }

  function renderRiskRadar() {
    const ctx = document.getElementById('risk-radar').getContext('2d');
    const negativeRatio = reportData.sentiments.negativo / reportData.total_comments;

    new Chart(ctx, {
      type: 'radar',
      data: {
        labels: ['Rejei√ß√£o Popular', 'Crise Tribut√°ria', 'Risco Eleitoral', 'Imagem P√∫blica', 'Viabilidade Estadual'],
        datasets: [{
          label: 'N√≠vel de Risco',
          data: [
            Math.min(negativeRatio * 100, 100),
            Math.min(negativeRatio * 120, 100),
            Math.min((reportData.sentiments.negativo / Math.max(reportData.sentiments.positivo, 1)) * 30, 100),
            Math.min(negativeRatio * 90, 100),
            Math.min(negativeRatio * 85, 100)
          ],
          backgroundColor: 'rgba(255, 107, 107, 0.2)',
          borderColor: '#ff6b6b',
          borderWidth: 2,
          pointBackgroundColor: '#ff6b6b',
          pointBorderColor: '#fff',
          pointHoverBackgroundColor: '#fff',
          pointHoverBorderColor: '#ff6b6b'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          r: {
            beginAtZero: true,
            max: 100,
            ticks: { color: '#8892b0', backdropColor: 'transparent', stepSize: 20 },
            grid: { color: '#2e3350' },
            pointLabels: { color: '#e8eaf6', font: { size: 11 } }
          }
        },
        plugins: {
          legend: { display: false }
        }
      }
    });
  }

  function renderLocationChart() {
    const ctx = document.getElementById('location-chart').getContext('2d');
    const locations = Object.entries(reportData.locations)
      .filter(([name]) => name !== 'N√£o especificado')
      .sort((a, b) => b[1] - a[1])
      .slice(0, 10);

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: locations.map(l => l[0]),
        datasets: [{
          label: 'Men√ß√µes',
          data: locations.map(l => l[1]),
          backgroundColor: 'rgba(108, 99, 255, 0.8)',
          borderColor: '#6c63ff',
          borderWidth: 1,
          borderRadius: 6
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false }
        },
        scales: {
          x: {
            grid: { color: '#2e3350' },
            ticks: { color: '#8892b0' }
          },
          y: {
            grid: { display: false },
            ticks: { color: '#e8eaf6', font: { size: 11 } }
          }
        }
      }
    });
  }

  function renderLocationBars() {
    const locations = Object.entries(reportData.locations)
      .filter(([name]) => name !== 'N√£o especificado')
      .sort((a, b) => b[1] - a[1])
      .slice(0, 8);

    const maxCount = Math.max(...locations.map(l => l[1]));
    const container = document.getElementById('location-bars');

    container.innerHTML = locations.map(([name, count]) => `
      <div class="loc-row">
        <div class="loc-name">${name}</div>
        <div class="loc-bar-wrap">
          <div class="loc-bar" style="width: ${(count / maxCount) * 100}%"></div>
        </div>
        <div class="loc-count">${count}</div>
      </div>
    `).join('');
  }

  function renderThemesChart() {
    const ctx = document.getElementById('themes-chart').getContext('2d');
    const themes = Object.entries(reportData.themes)
      .filter(([name]) => name !== 'Outros')
      .sort((a, b) => b[1] - a[1])
      .slice(0, 10);

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: themes.map(t => t[0]),
        datasets: [{
          label: 'Men√ß√µes',
          data: themes.map(t => t[1]),
          backgroundColor: 'rgba(0, 212, 170, 0.8)',
          borderColor: '#00d4aa',
          borderWidth: 1,
          borderRadius: 6
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false }
        },
        scales: {
          x: {
            grid: { color: '#2e3350' },
            ticks: { color: '#8892b0', maxRotation: 45, minRotation: 45 }
          },
          y: {
            grid: { display: false },
            ticks: { color: '#e8eaf6' }
          }
        }
      }
    });
  }

  function renderWordCloud() {
    const wordCounts = {};
    
    allComments.forEach(comment => {
      const words = comment.text.toLowerCase()
        .replace(/[^\w√Ä-√ø\s]/g, ' ')
        .split(/\s+/)
        .filter(w => w.length > 3 && !['para', 'pela', 'pelo', 'com', 'uma', 'isso', 'esse', 'esta', 'est√°'].includes(w));
      
      words.forEach(word => {
        wordCounts[word] = (wordCounts[word] || 0) + 1;
      });
    });

    const topWords = Object.entries(wordCounts)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 40);

    const maxCount = Math.max(...topWords.map(w => w[1]));
    const colors = ['#6c63ff', '#00d4aa', '#ff6b6b', '#ffd166', '#c77dff', '#a8dadc'];

    const container = document.getElementById('wordcloud');
    container.innerHTML = topWords.map(([word, count], i) => {
      const size = 0.7 + (count / maxCount) * 1.3;
      const color = colors[i % colors.length];
      return `<span class="word-tag" style="font-size: ${size}rem; color: ${color}; background: ${color}22; border: 1px solid ${color}44;">${word} (${count})</span>`;
    }).join('');
  }

  function renderAlerts() {
    const alerts = reportData.critical_alerts;
    const container = document.getElementById('alerts-container');

    if (alerts.length === 0) {
      container.innerHTML = '<div class="chart-card"><p style="color: var(--text-muted); text-align: center; padding: 20px;">‚úì Nenhum alerta cr√≠tico detectado</p></div>';
      return;
    }

    const grouped = {};
    alerts.forEach(alert => {
      grouped[alert] = (grouped[alert] || 0) + 1;
    });

    container.innerHTML = Object.entries(grouped).map(([alert, count]) => `
      <div class="alert-box">
        <div class="alert-title">üö® ${alert}</div>
        <div style="color: var(--text-muted);">${count} ocorr√™ncias detectadas no monitoramento</div>
      </div>
    `).join('');
  }

  function renderComments() {
    const sortedComments = [...allComments].sort((a, b) => {
      const engageA = parseInt(a.likes || 0) + parseInt(a.replies || 0);
      const engageB = parseInt(b.likes || 0) + parseInt(b.replies || 0);
      return engageB - engageA;
    });

    displayComments(sortedComments.slice(0, 20));
  }

  function displayComments(comments) {
    const container = document.getElementById('comments-list');
    container.innerHTML = comments.map(comment => {
      const initial = comment.username.charAt(0).toUpperCase();
      const sentimentClass = `badge-${comment.sentiment === 'negativo' ? 'neg' : comment.sentiment === 'positivo' ? 'pos' : 'neu'}`;
      
      return `
        <div class="comment-card">
          <div class="comment-header">
            <div class="comment-avatar">${initial}</div>
            <div style="flex: 1;">
              <div class="comment-user">@${comment.username}</div>
              <div class="comment-meta">${new Date(comment.timestamp || Date.now()).toLocaleDateString('pt-BR')}</div>
            </div>
          </div>
          <div class="comment-text">${comment.text}</div>
          <div class="comment-footer">
            <span class="badge ${sentimentClass}">${comment.sentiment}</span>
            ${comment.locations.filter(l => l !== 'N√£o especificado').map(loc => 
              `<span class="badge" style="background: rgba(168, 85, 247, 0.15); color: #c77dff;">üìç ${loc}</span>`
            ).join('')}
            <span style="color: var(--text-muted); font-size: 0.75rem; margin-left: auto;">‚ù§Ô∏è ${comment.likes || 0} ‚Ä¢ üí¨ ${comment.replies || 0}</span>
          </div>
        </div>
      `;
    }).join('');
  }

  function filterComments(sentiment) {
    currentFilter = sentiment;
    
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');

    let filtered = allComments;
    if (sentiment !== 'all') {
      filtered = allComments.filter(c => c.sentiment === sentiment);
    }

    const sorted = filtered.sort((a, b) => {
      const engageA = parseInt(a.likes || 0) + parseInt(a.replies || 0);
      const engageB = parseInt(b.likes || 0) + parseInt(b.replies || 0);
      return engageB - engageA;
    });

    displayComments(sorted.slice(0, 20));
  }

  function searchComments() {
    const searchTerm = document.getElementById('search-comments').value.toLowerCase();
    
    let filtered = allComments;
    if (currentFilter !== 'all') {
      filtered = filtered.filter(c => c.sentiment === currentFilter);
    }
    
    if (searchTerm) {
      filtered = filtered.filter(c => c.text.toLowerCase().includes(searchTerm));
    }

    const sorted = filtered.sort((a, b) => {
      const engageA = parseInt(a.likes || 0) + parseInt(a.replies || 0);
      const engageB = parseInt(b.likes || 0) + parseInt(b.replies || 0);
      return engageB - engageA;
    });

    displayComments(sorted.slice(0, 20));
  }

  function renderStrategicInsights() {
    const insights = [
      `<strong>Alta Rejei√ß√£o:</strong> ${((reportData.sentiments.negativo / reportData.total_comments) * 100).toFixed(1)}% de sentimento negativo indica insatisfa√ß√£o cr√≠tica com a Taxa do Lixo.`,
      `<strong>Principais Bairros Afetados:</strong> ${Object.keys(reportData.locations).filter(l => l !== 'N√£o especificado').slice(0, 3).join(', ')} concentram a maioria das reclama√ß√µes.`,
      `<strong>Tema Dominante:</strong> "Lixo" foi mencionado ${reportData.themes.Lixo || 0} vezes, confirmando foco da insatisfa√ß√£o.`,
      `<strong>Compara√ß√£o com IPTU:</strong> Popula√ß√£o questiona legitimidade da taxa ao compar√°-la com IPTU j√° pago.`,
      `<strong>A√ß√£o Urgente:</strong> Audi√™ncias p√∫blicas nos principais bairros afetados s√£o priorit√°rias.`,
      `<strong>Comunica√ß√£o:</strong> Campanha explicativa sobre destina√ß√£o dos recursos √© essencial para reverter narrativa.`,
      `<strong>Contrapartidas:</strong> Demonstra√ß√£o de melhorias na coleta e limpeza deve ser imediata e vis√≠vel.`,
      `<strong>Risco Eleitoral:</strong> Situa√ß√£o atual compromete viabilidade de reelei√ß√£o se n√£o for revertida rapidamente.`
    ];

    document.getElementById('strategic-insights').innerHTML = `
      <div style="display: grid; gap: 12px; margin-top: 16px;">
        ${insights.map(insight => `
          <div style="background: var(--surface2); border-left: 3px solid var(--accent); padding: 12px 16px; border-radius: 6px;">
            <p style="font-size: 0.85rem; color: var(--text-muted); line-height: 1.5;">${insight}</p>
          </div>
        `).join('')}
      </div>
    `;
  }

  // Load data on page load
  loadData();
</script>

</body>
</html>
