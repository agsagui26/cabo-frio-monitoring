<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üêµ SAGUI ‚Äî Monitoramento Cabo Frio</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
  <style>
    :root {
      --bg: #0f1117; --surface: #1a1d27; --surface2: #22263a; --border: #2e3350;
      --accent: #6c63ff; --accent2: #00d4aa; --negative: #ff6b6b; --accent4: #ffd166;
      --text: #e8eaf6; --text-muted: #8892b0; --positive: #00d4aa; --neutral: #8892b0;
      --radius: 14px; --shadow: 0 4px 24px rgba(0,0,0,0.4);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
    header { background: linear-gradient(135deg, #1a1d27 0%, #0f1117 100%); border-bottom: 1px solid var(--border); padding: 28px 40px 24px; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(12px); }
    .header-inner { max-width: 1600px; margin: 0 auto; }
    .header-top { display: flex; align-items: center; gap: 16px; flex-wrap: wrap; justify-content: space-between; }
    .logo-badge { background: linear-gradient(135deg, var(--accent), var(--accent2)); border-radius: 10px; padding: 8px 14px; font-size: 12px; font-weight: 700; letter-spacing: 1.5px; text-transform: uppercase; color: #fff; display: flex; align-items: center; gap: 6px; }
    header h1 { font-size: 1.4rem; font-weight: 700; color: var(--text); }
    header p { font-size: 0.85rem; color: var(--text-muted); margin-top: 6px; }
    .header-meta { display: flex; gap: 20px; margin-top: 12px; flex-wrap: wrap; }
    .meta-chip { background: var(--surface2); border: 1px solid var(--border); border-radius: 20px; padding: 4px 12px; font-size: 0.78rem; color: var(--text-muted); }
    .meta-chip strong { color: var(--accent2); }
    .nav-tabs { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 8px; display: flex; gap: 6px; margin: 20px auto; max-width: 1600px; flex-wrap: wrap; }
    .nav-tab { flex: 1; min-width: 160px; padding: 12px 20px; background: transparent; border: none; color: var(--text-muted); cursor: pointer; font-size: 0.85rem; font-weight: 600; border-radius: 8px; transition: all 0.3s; text-align: center; }
    .nav-tab:hover { background: rgba(108, 99, 255, 0.1); color: var(--accent); }
    .nav-tab.active { background: linear-gradient(135deg, var(--accent), var(--accent2)); color: #fff; }
    main { max-width: 1600px; margin: 0 auto; padding: 32px 24px 60px; }
    .page-content { display: none; }
    .page-content.active { display: block; }
    .section-title { font-size: 0.7rem; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; color: var(--accent); margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
    .section-title::after { content: ''; flex: 1; height: 1px; background: var(--border); }
    .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 32px; }
    .kpi-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px 22px; position: relative; overflow: hidden; transition: transform 0.2s, box-shadow 0.2s; }
    .kpi-card:hover { transform: translateY(-2px); box-shadow: var(--shadow); }
    .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; }
    .kpi-card.accent::before { background: linear-gradient(90deg, var(--accent), var(--accent2)); }
    .kpi-card.negative::before { background: var(--negative); }
    .kpi-card.positive::before { background: var(--positive); }
    .kpi-card.neutral::before { background: var(--neutral); }
    .kpi-card.warning::before { background: var(--accent4); }
    .kpi-label { font-size: 0.72rem; color: var(--text-muted); letter-spacing: 0.5px; text-transform: uppercase; }
    .kpi-value { font-size: 2rem; font-weight: 800; margin: 6px 0 2px; line-height: 1; }
    .kpi-sub { font-size: 0.75rem; color: var(--text-muted); }
    .chart-grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(480px, 1fr)); gap: 20px; margin-bottom: 28px; }
    .chart-card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 22px 24px; box-shadow: var(--shadow); }
    .chart-card h3 { font-size: 0.88rem; font-weight: 600; color: var(--text); margin-bottom: 4px; }
    .chart-card p { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 16px; }
    .chart-wrap { position: relative; height: 350px; }
    .wordcloud-wrap { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; padding: 12px 0; max-height: 320px; overflow-y: auto; }
    .word-tag { border-radius: 6px; padding: 6px 12px; cursor: pointer; transition: transform 0.15s; font-weight: 600; white-space: nowrap; font-size: 0.85rem; }
    .word-tag:hover { transform: scale(1.08); }
    .comment-list { display: flex; flex-direction: column; gap: 12px; max-height: 600px; overflow-y: auto; }
    .comment-card { background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; padding: 14px 16px; }
    .comment-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; justify-content: space-between; flex-wrap: wrap; }
    .comment-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), var(--accent2)); display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; color: #fff; flex-shrink: 0; }
    .comment-user { font-size: 0.82rem; font-weight: 600; }
    .comment-text { font-size: 0.88rem; line-height: 1.6; color: var(--text); margin-bottom: 10px; padding: 8px 0; }
    .comment-footer { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    .badge { display: inline-block; border-radius: 20px; padding: 3px 12px; font-size: 0.72rem; font-weight: 700; }
    .badge-neg { background: rgba(255,107,107,0.15); color: var(--negative); border: 1px solid rgba(255,107,107,0.3); }
    .badge-pos { background: rgba(0,212,170,0.15); color: var(--positive); border: 1px solid rgba(0,212,170,0.3); }
    .badge-neu { background: rgba(136,146,176,0.15); color: var(--neutral); border: 1px solid rgba(136,146,176,0.3); }
    .badge-location { background: rgba(168,85,247,0.15); color: #c77dff; border: 1px solid rgba(168,85,247,0.3); }
    .badge-theme { background: rgba(255,209,102,0.15); color: var(--accent4); border: 1px solid rgba(255,209,102,0.3); }
    .search-box { width: 100%; padding: 12px 16px; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 0.85rem; margin-bottom: 16px; font-family: inherit; }
    .search-box:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.1); }
    .alert-box { background: rgba(255,107,107,0.1); border: 1px solid rgba(255,107,107,0.3); border-left: 4px solid var(--negative); border-radius: var(--radius); padding: 16px 20px; margin-bottom: 16px; }
    .alert-title { font-weight: 700; color: var(--negative); margin-bottom: 6px; font-size: 0.82rem; text-transform: uppercase; letter-spacing: 1px; }
    .gabriela-alert { background: linear-gradient(135deg, rgba(255,107,107,0.15), rgba(255,209,102,0.1)); border: 2px solid var(--negative); border-radius: var(--radius); padding: 24px; margin-bottom: 20px; animation: pulse-border 2s infinite; }
    @keyframes pulse-border { 0%, 100% { border-color: var(--negative); } 50% { border-color: var(--accent4); } }
    .location-bars { display: flex; flex-direction: column; gap: 10px; }
    .loc-row { display: flex; align-items: center; gap: 12px; }
    .loc-name { font-size: 0.85rem; min-width: 140px; color: var(--text); font-weight: 500; }
    .loc-bar-wrap { flex: 1; background: var(--surface2); border-radius: 6px; height: 12px; overflow: hidden; }
    .loc-bar { height: 100%; border-radius: 6px; background: linear-gradient(90deg, var(--accent), var(--accent2)); transition: width 0.8s ease; }
    .loc-count { font-size: 0.8rem; color: var(--text-muted); min-width: 50px; text-align: right; font-weight: 600; }
    .map-container { background: var(--surface2); border-radius: var(--radius); height: 500px; position: relative; border: 1px solid var(--border); overflow: hidden; }
    .heatmap-point { position: absolute; border-radius: 50%; cursor: pointer; animation: pulse-point 2s infinite; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 10px; box-shadow: 0 0 20px currentColor; transition: all 0.3s; }
    .heatmap-point:hover { transform: scale(1.3); z-index: 10; }
    @keyframes pulse-point { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.2); opacity: 0.8; } }
    .theme-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px; margin-bottom: 30px; }
    .theme-folder { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s; }
    .theme-folder:hover { transform: translateY(-2px); box-shadow: var(--shadow); border-color: var(--accent); }
    .theme-icon { font-size: 2rem; margin-bottom: 10px; }
    .theme-count { font-size: 1.8rem; font-weight: 800; color: var(--accent2); margin-bottom: 6px; }
    .theme-name { font-size: 0.85rem; color: var(--text); font-weight: 600; }
    .theme-detail { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 24px; margin-bottom: 20px; }
    .theme-detail h4 { font-size: 1rem; color: var(--accent); margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
    .demand-list { list-style: none; }
    .demand-item { background: var(--surface2); border-left: 3px solid var(--accent2); padding: 12px 16px; margin-bottom: 10px; border-radius: 6px; font-size: 0.85rem; line-height: 1.5; }
    .demand-item strong { color: var(--accent2); margin-right: 8px; }
    .insight-box { background: linear-gradient(135deg, rgba(108,99,255,0.1), rgba(0,212,170,0.05)); border: 1px solid rgba(108,99,255,0.3); border-radius: var(--radius); padding: 16px 20px; margin-bottom: 16px; }
    .insight-box h4 { font-size: 0.82rem; color: var(--accent); margin-bottom: 8px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
    .insight-box p { font-size: 0.85rem; color: var(--text-muted); line-height: 1.6; }
    .insight-box strong { color: var(--text); }
    .filter-tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
    .filter-tab { padding: 8px 16px; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; color: var(--text-muted); font-size: 0.8rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
    .filter-tab:hover { border-color: var(--accent); color: var(--accent); }
    .filter-tab.active { background: var(--accent); border-color: var(--accent); color: #fff; }
    .theme-button { background: var(--surface2); border: 2px solid var(--border); border-radius: 50px; padding: 12px 24px; color: var(--text); font-weight: 600; display: inline-block; margin: 8px; cursor: pointer; transition: all 0.3s; font-size: 0.85rem; }
    .theme-button:hover { background: var(--accent); border-color: var(--accent); transform: translateY(-2px); color: #fff; }
    .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
    .summary-card { background: var(--surface2); padding: 15px; border-radius: 8px; border-left: 3px solid var(--accent2); }
    .summary-label { font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 6px; }
    .summary-value { font-size: 1.2rem; font-weight: 700; color: var(--text); }
    .benchmarking-card { background: var(--surface2); border-left: 3px solid var(--accent2); padding: 15px; margin-bottom: 12px; border-radius: 6px; }
    .benchmarking-card.success { border-left-color: var(--positive); background: rgba(0,212,170,0.05); }
    .benchmarking-card.failure { border-left-color: var(--negative); background: rgba(255,107,107,0.05); }
    .sagui-ia { display: flex; align-items: center; gap: 8px; }
    .risk-indicator { display: inline-block; padding: 4px 12px; border-radius: 6px; font-weight: 700; font-size: 0.75rem; }
    .risk-critical { background: rgba(255,107,107,0.2); color: var(--negative); border: 1px solid var(--negative); }
    .risk-high { background: rgba(255,209,102,0.2); color: var(--accent4); border: 1px solid var(--accent4); }
    .risk-medium { background: rgba(108,99,255,0.2); color: var(--accent); border: 1px solid var(--accent); }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: var(--surface); }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
    @media (max-width: 768px) { header { padding: 20px 16px; } main { padding: 20px 12px 40px; } .chart-grid-2 { grid-template-columns: 1fr; } .kpi-grid { grid-template-columns: repeat(2, 1fr); } .theme-grid { grid-template-columns: repeat(2, 1fr); } }
    footer { text-align: center; padding: 24px; font-size: 0.75rem; color: var(--text-muted); border-top: 1px solid var(--border); margin-top: 40px; }
  </style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="header-top">
      <div style="display: flex; align-items: center; gap: 16px;">
        <span class="logo-badge"><span style="font-size: 16px;">üêµ</span> SAGUI</span>
        <div>
          <h1>Monitoramento de Redes Sociais ‚Äî Fevereiro</h1>
          <p>Sistema de An√°lise L√©xico-Sem√¢ntica ‚Ä¢ Cabo Frio - RJ</p>
        </div>
      </div>
      <div style="text-align: right;">
        <div style="font-size: 1.8rem; font-weight: 800; color: var(--accent2);" id="current-date">25</div>
        <div style="font-size: 0.75rem; color: var(--text-muted);">FEV 2026</div>
      </div>
    </div>
    <div class="header-meta" id="header-meta">
      <span class="meta-chip">Total: <strong>0 coment√°rios</strong></span>
      <span class="meta-chip">Per√≠odo: <strong>Fevereiro 2026</strong></span>
      <span class="meta-chip">Fontes: <strong>Instagram + Facebook</strong></span>
      <span class="meta-chip">Status: <strong>Processando...</strong></span>
    </div>
  </div>
</header>

<div class="nav-tabs">
  <button class="nav-tab active" onclick="showPage('overview')">üìä Vis√£o Geral</button>
  <button class="nav-tab" onclick="showPage('comments')">üí¨ Coment√°rios</button>
  <button class="nav-tab" onclick="showPage('locations')">üìç Localiza√ß√£o</button>
  <button class="nav-tab" onclick="showPage('themes')">üìÅ Temas/Pedidos</button>
</div>

<main>

  <!-- P√ÅGINA 1: VIS√ÉO GERAL -->
  <div id="overview" class="page-content active">
    
    <div class="section-title">Indicadores Gerais</div>
    <div class="kpi-grid">
      <div class="kpi-card accent">
        <div class="kpi-label">Total de Coment√°rios</div>
        <div class="kpi-value" style="color:var(--accent2)" id="kpi-total">0</div>
        <div class="kpi-sub">Volume massivo detectado</div>
      </div>
      <div class="kpi-card negative">
        <div class="kpi-label">Sentimento Negativo</div>
        <div class="kpi-value" style="color:var(--negative)" id="kpi-negative">0%</div>
        <div class="kpi-sub"><span id="kpi-negative-count">0</span> coment√°rios</div>
      </div>
      <div class="kpi-card neutral">
        <div class="kpi-label">Sentimento Neutro</div>
        <div class="kpi-value" style="color:var(--neutral)" id="kpi-neutral">0%</div>
        <div class="kpi-sub"><span id="kpi-neutral-count">0</span> coment√°rios</div>
      </div>
      <div class="kpi-card positive">
        <div class="kpi-label">Sentimento Positivo</div>
        <div class="kpi-value" style="color:var(--positive)" id="kpi-positive">0%</div>
        <div class="kpi-sub"><span id="kpi-positive-count">0</span> coment√°rios</div>
      </div>
      <div class="kpi-card warning">
        <div class="kpi-label">Ratio Neg:Pos</div>
        <div class="kpi-value" style="color:var(--accent4)" id="kpi-ratio">0:1</div>
        <div class="kpi-sub">√çndice de rejei√ß√£o</div>
      </div>
      <div class="kpi-card accent">
        <div class="kpi-label">Alertas Cr√≠ticos</div>
        <div class="kpi-value" style="color:var(--negative)" id="kpi-alerts">0</div>
        <div class="kpi-sub">Monitoramento ativo</div>
      </div>
    </div>

    <div class="insight-box">
      <h4>üéØ Resumo Executivo Estrat√©gico</h4>
      <p id="executive-summary">Carregando an√°lise...</p>
    </div>

    <div class="section-title">‚è∞ An√°lise Temporal Detalhada</div>
    <div class="chart-card">
      <h3>Volume de Coment√°rios por Hora do Dia</h3>
      <p>Padr√£o de engajamento ao longo de 24 horas ‚Ä¢ Identifica√ß√£o do melhor hor√°rio para comunica√ß√£o oficial</p>
      <div class="chart-wrap">
        <canvas id="hourly-chart"></canvas>
      </div>
      <div id="temporal-insights" style="margin-top: 15px; padding: 12px; background: rgba(108,99,255,0.1); border-radius: 6px; font-size: 0.85rem;"></div>
    </div>

    <div class="section-title">An√°lise de Sentimentos e Risco</div>
    <div class="chart-grid-2">
      <div class="chart-card">
        <h3>Distribui√ß√£o de Sentimentos</h3>
        <p>An√°lise l√©xico-sem√¢ntica com detec√ß√£o de ironia e sarcasmo</p>
        <div class="chart-wrap">
          <canvas id="sentiment-pie"></canvas>
        </div>
      </div>
      <div class="chart-card">
        <h3>√çndice de Risco Pol√≠tico Multidimensional</h3>
        <p>Avalia√ß√£o atualizada com base em 1.492 coment√°rios</p>
        <div class="chart-wrap">
          <canvas id="risk-radar"></canvas>
        </div>
        <div id="risk-assessment" style="margin-top: 15px;"></div>
      </div>
    </div>

    <div class="section-title">üí° Insights Estrat√©gicos Aprofundados</div>
    <div id="strategic-insights"></div>

    <div class="section-title">üèÜ Benchmarking Expandido</div>
    <div class="chart-card">
      <h3>O que Funcionou (e o que N√ÉO Funcionou) em Outras Cidades</h3>
      <p>An√°lise comparativa de 8 casos municipais de implementa√ß√£o de taxa de lixo</p>
      <div id="benchmarking-section"></div>
    </div>

    <div class="section-title sagui-ia">üêµ A√ß√µes Sugeridas pela SAGUI.ia</div>
    <div class="chart-card">
      <h3>Plano de A√ß√£o Inteligente (Timeline 7-30-90 dias)</h3>
      <div id="sagui-suggestions"></div>
    </div>

  </div>

  <!-- P√ÅGINA 2: COMENT√ÅRIOS -->
  <div id="comments" class="page-content">
    
    <div class="section-title">üí¨ Principais Coment√°rios Bem Elaborados</div>
    <div class="chart-card">
      <h3>Coment√°rios Detalhados com Endere√ßo e Pedidos Claros</h3>
      <p>Priorizando coment√°rios que indicam localiza√ß√£o espec√≠fica e demandas objetivas</p>
      <div class="comment-list" id="detailed-comments"></div>
    </div>

    <div class="section-title">‚òÅÔ∏è Nuvem de Palavras Interativa</div>
    <div class="chart-card">
      <h3>Top 50 Palavras Mais Frequentes</h3>
      <p>An√°lise de frequ√™ncia de termos nos coment√°rios ‚Ä¢ Clique para buscar</p>
      <div class="wordcloud-wrap" id="wordcloud-comments"></div>
    </div>

    <div class="section-title">üìù Todos os Coment√°rios</div>
    <div class="chart-card">
      <h3>Listagem Completa com Filtros Avan√ßados</h3>
      <p>Busque e filtre por sentimento ‚Ä¢ Exibindo top 100 coment√°rios por engajamento</p>
      
      <div class="filter-tabs">
        <button class="filter-tab active" onclick="filterCommentsBySentiment('all')">Todos</button>
        <button class="filter-tab" onclick="filterCommentsBySentiment('negativo')">Negativos</button>
        <button class="filter-tab" onclick="filterCommentsBySentiment('neutro')">Neutros</button>
        <button class="filter-tab" onclick="filterCommentsBySentiment('positivo')">Positivos</button>
      </div>

      <input type="text" class="search-box" id="search-all-comments" placeholder="üîç Buscar palavra espec√≠fica nos coment√°rios..." onkeyup="searchAllComments()">
      
      <div class="comment-list" id="all-comments-list"></div>
    </div>

    <div class="section-title">üö® Monitoramento de Palavras Cr√≠ticas</div>
    <div id="critical-monitoring"></div>

    <div class="gabriela-alert" id="gabriela-alert-box">
      <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
        <div style="font-size: 32px;">‚ö†Ô∏è</div>
        <div>
          <strong style="color: var(--negative); font-size: 18px;">MONITORAMENTO POL√çTICO ATIVO</strong><br>
          <small style="color: var(--text-muted);">Candidatura Estadual: Gabriela Azevedo (irm√£ do prefeito)</small>
        </div>
      </div>
      
      <div style="background: #1a1d27; padding: 15px; border-radius: 8px; margin-top: 15px;">
        <div style="margin-bottom: 10px;">
          <strong style="color: var(--accent4);">üìä Total de Men√ß√µes:</strong> <span style="color: var(--accent2); font-size: 24px; font-weight: bold;" id="gabriela-count">0</span>
        </div>
        
        <div style="color: var(--text-muted); font-size: 13px; line-height: 1.6;">
          <strong>Palavras-chave monitoradas 24/7:</strong><br>
          ‚Ä¢ "Gabriela Azevedo" ‚Ä¢ "Irm√£ do prefeito"<br>
          ‚Ä¢ "Deputada estadual Gabriela" ‚Ä¢ "Candidata Gabriela"<br>
          ‚Ä¢ Varia√ß√µes e apelidos detectados automaticamente
        </div>
        
        <div id="gabriela-status" style="margin-top: 15px; padding: 12px; background: rgba(0,212,170,0.1); border-radius: 6px; border-left: 3px solid var(--positive);">
          <strong style="color: var(--positive);">‚úì Status:</strong> Nenhuma men√ß√£o detectada neste per√≠odo
        </div>
      </div>
    </div>

  </div>

  <!-- P√ÅGINA 3: LOCALIZA√á√ÉO -->
  <div id="locations" class="page-content">
    
    <div class="section-title">üó∫Ô∏è Mapa de Calor Interativo - Cabo Frio</div>
    <div class="chart-card">
      <h3>Visualiza√ß√£o Geogr√°fica com Pontos Pulsantes</h3>
      <p>13 bairros mapeados ‚Ä¢ Intensidade por volume de men√ß√µes ‚Ä¢ Clique nos pontos para detalhes</p>
      <div class="map-container" id="heatmap-container">
        <div style="text-align: center; padding: 40px; color: var(--text-muted);">
          <div style="font-size: 3rem; margin-bottom: 10px;">üó∫Ô∏è</div>
          <div><strong>Mapa de Cabo Frio</strong></div>
          <div style="font-size: 0.75rem; margin-top: 8px;">Carregando pontos de calor...</div>
        </div>
      </div>
      <div style="display: flex; gap: 20px; margin-top: 15px; justify-content: center; flex-wrap: wrap;">
        <span style="font-size: 0.75rem;"><span style="color: #ff6b6b;">‚óè</span> Alta intensidade (>10)</span>
        <span style="font-size: 0.75rem;"><span style="color: #ffd166;">‚óè</span> M√©dia intensidade (5-10)</span>
        <span style="font-size: 0.75rem;"><span style="color: #00d4aa;">‚óè</span> Baixa intensidade (<5)</span>
      </div>
    </div>

    <div class="section-title">üìä An√°lise Detalhada por Bairro</div>
    <div class="chart-grid-2">
      <div class="chart-card">
        <h3>Distribui√ß√£o de Men√ß√µes por Localidade</h3>
        <p>Gr√°fico de barras com ranking completo</p>
        <div class="chart-wrap">
          <canvas id="location-chart-detail"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <h3>Barras de Intensidade Animadas</h3>
        <p>Visualiza√ß√£o comparativa em tempo real</p>
        <div class="location-bars" id="location-bars-detail" style="padding: 20px 0;"></div>
      </div>
    </div>

    <div class="section-title">üìç Principais Cobran√ßas da Popula√ß√£o por Localiza√ß√£o</div>
    <div id="demands-by-location"></div>

  </div>

  <!-- P√ÅGINA 4: TEMAS/PEDIDOS -->
  <div id="themes" class="page-content">
    
    <div class="section-title">üìä Distribui√ß√£o Completa de Temas</div>
    <div class="chart-card">
      <h3>An√°lise de Categorias Identificadas</h3>
      <p>14 categorias tem√°ticas mapeadas automaticamente</p>
      <div class="chart-wrap">
        <canvas id="themes-chart-detail"></canvas>
      </div>
    </div>

    <div class="section-title">üìÅ Categorias Tem√°ticas (Dashboard Visual)</div>
    <div class="theme-grid" id="theme-folders"></div>

    <div class="section-title">üîù Ranking Detalhado de Demandas por Tema</div>
    <div id="theme-details"></div>

  </div>

</main>

<footer>
  <strong>üêµ SAGUI Data Center</strong> ‚Äî Sistema de Monitoramento de Redes Sociais<br>
  Cabo Frio - RJ ‚Ä¢ An√°lise L√©xico-Sem√¢ntica Automatizada ‚Ä¢ 2026<br>
  <small style="opacity: 0.7;">Dashboard v3.0 FINAL ‚Ä¢ 1.492 Coment√°rios Processados</small>
</footer>

<script>
  let reportData = null;
  let allComments = [];
  let currentCommentFilter = 'all';

  const themeIcons = {
    'Saneamento': 'üö∞', 'Estradas': 'üõ£Ô∏è', 'Ordenamento': 'üèõÔ∏è', 'Sa√∫de': 'üè•',
    'Seguran√ßa': 'üëÆ', 'Ilumina√ß√£o': 'üí°', 'Lixo': 'üóëÔ∏è', 'Moradores de rua': 'üè†',
    'Mobilidade': 'üöå', 'Esporte/lazer': '‚öΩ', 'Educa√ß√£o': 'üìö', 'Turismo': 'üèñÔ∏è',
    'Pediatria': 'üë∂', 'Canil municipal': 'üêï'
  };

  function showPage(pageId) {
    document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    event.target.classList.add('active');
  }

  async function loadData() {
    try {
      const response = await fetch('report_data.json');
      reportData = await response.json();
      allComments = reportData.all_comments || [];
      renderAllPages();
    } catch (error) {
      console.error('Erro:', error);
      document.getElementById('executive-summary').innerHTML = 
        '<strong style="color: var(--negative)">‚ùå Erro ao carregar report_data.json</strong><br>Certifique-se de que o arquivo est√° na mesma pasta que index.html';
    }
  }

  function renderAllPages() {
    if (!reportData) return;
    updateHeader();
    updateKPIs();
    renderExecutiveSummary();
    renderHourlyChart();
    renderSentimentPie();
    renderRiskRadar();
    renderStrategicInsights();
    renderBenchmarking();
    renderSaguiSuggestions();
    renderDetailedComments();
    renderWordCloudComments();
    renderAllComments();
    renderCriticalMonitoring();
    renderGabrielaAlert();
    renderHeatmap();
    renderLocationChartDetail();
    renderLocationBarsDetail();
    renderDemandsByLocation();
    renderThemesChartDetail();
    renderThemeFolders();
    renderThemeDetails();
  }

  function updateHeader() {
    const total = reportData.total_comments;
    document.getElementById('header-meta').innerHTML = `
      <span class="meta-chip">Total: <strong>${total.toLocaleString('pt-BR')} coment√°rios</strong></span>
      <span class="meta-chip">Per√≠odo: <strong>Fevereiro 2026</strong></span>
      <span class="meta-chip">Fontes: <strong>Instagram + Facebook</strong></span>
      <span class="meta-chip">Status: <strong>‚úì An√°lise Conclu√≠da</strong></span>
    `;
    const now = new Date();
    document.getElementById('current-date').textContent = now.getDate();
  }

  function updateKPIs() {
    const total = reportData.total_comments;
    const s = reportData.sentiments;
    document.getElementById('kpi-total').textContent = total.toLocaleString('pt-BR');
    
    const negPct = ((s.negativo / total) * 100).toFixed(1);
    document.getElementById('kpi-negative').textContent = negPct + '%';
    document.getElementById('kpi-negative-count').textContent = s.negativo;
    
    const neuPct = ((s.neutro / total) * 100).toFixed(1);
    document.getElementById('kpi-neutral').textContent = neuPct + '%';
    document.getElementById('kpi-neutral-count').textContent = s.neutro;
    
    const posPct = ((s.positivo / total) * 100).toFixed(1);
    document.getElementById('kpi-positive').textContent = posPct + '%';
    document.getElementById('kpi-positive-count').textContent = s.positivo;
    
    const ratio = s.positivo > 0 ? (s.negativo / s.positivo).toFixed(1) : '‚àû';
    document.getElementById('kpi-ratio').textContent = ratio + ':1';
    
    const alertsCount = reportData.critical_alerts ? reportData.critical_alerts.length : 0;
    document.getElementById('kpi-alerts').textContent = alertsCount;
  }

  function renderExecutiveSummary() {
    const total = reportData.total_comments;
    const s = reportData.sentiments;
    const negPct = ((s.negativo / total) * 100).toFixed(1);
    const posPct = ((s.positivo / total) * 100).toFixed(1);
    const ratio = s.positivo > 0 ? (s.negativo / s.positivo).toFixed(1) : '999';
    
    let status = negPct > 40 ? '<strong style="color: var(--negative)">üî¥ CRISE CONFIRMADA</strong>' :
                 negPct > 25 ? '<strong style="color: var(--accent4)">üü° ALERTA ELEVADO</strong>' :
                 '<strong style="color: var(--positive)">üü¢ SITUA√á√ÉO CONTROLADA</strong>';
    
    const topLocs = Object.entries(reportData.locations)
      .filter(([n]) => n !== 'N√£o especificado')
      .sort((a, b) => b[1] - a[1])
      .slice(0, 3)
      .map(l => l[0])
      .join(', ');
    
    const lixoCount = reportData.themes.Lixo || 0;
    const lixoPct = ((lixoCount / total) * 100).toFixed(1);
    
    document.getElementById('executive-summary').innerHTML = `
      ${status} ‚Ä¢ 
      An√°lise de <strong>${total.toLocaleString('pt-BR')} coment√°rios</strong> revela 
      <strong>${negPct}%</strong> de rejei√ß√£o (<strong>ratio ${ratio}:1</strong> negativo vs positivo). 
      <br><br>
      <strong>Tema Dominante:</strong> Taxa do Lixo (${lixoCount} men√ß√µes / ${lixoPct}% do total) ‚Ä¢ 
      <strong>Bairros Cr√≠ticos:</strong> ${topLocs} ‚Ä¢ 
      <strong>Alertas:</strong> ${reportData.critical_alerts?.length || 0} detectados
      <br><br>
      <strong>A√ß√£o Urgente:</strong> Audi√™ncias p√∫blicas descentralizadas + Portal de transpar√™ncia + 
      Suspens√£o de multas por 60 dias ‚Ä¢ <strong>Janela:</strong> 7-30 dias para reverter narrativa
    `;
  }

  function renderHourlyChart() {
    const ctx = document.getElementById('hourly-chart').getContext('2d');
    const hourly = reportData.hourly_distribution || Array(24).fill(0);
    const peakHour = hourly.indexOf(Math.max(...hourly));
    const peakCount = Math.max(...hourly);
    
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: Array.from({length: 24}, (_, i) => i + 'h'),
        datasets: [{
          label: 'Coment√°rios',
          data: hourly,
          borderColor: '#6c63ff',
          backgroundColor: 'rgba(108, 99, 255, 0.1)',
          tension: 0.4,
          fill: true,
          borderWidth: 3,
          pointBackgroundColor: '#6c63ff',
          pointBorderColor: '#fff',
          pointHoverRadius: 7,
          pointRadius: 4
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: (context) => `${context.parsed.y} coment√°rios √†s ${context.label}`
            }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            grid: { color: '#2e3350' },
            ticks: { color: '#8892b0' }
          },
          x: {
            grid: { display: false },
            ticks: { color: '#8892b0' }
          }
        }
      }
    });
    
    document.getElementById('temporal-insights').innerHTML = `
      <strong style="color: var(--accent);">üìä Insights Temporais:</strong><br>
      ‚Ä¢ Pico de engajamento: <strong>${peakHour}h</strong> (${peakCount} coment√°rios)<br>
      ‚Ä¢ Melhor hor√°rio para posts oficiais: <strong>10h-11h</strong> (antes do pico do almo√ßo)<br>
      ‚Ä¢ Padr√£o: Baixo volume madrugada (0h-6h), crescimento gradual at√© pico noturno
    `;
  }

  function renderSentimentPie() {
    const ctx = document.getElementById('sentiment-pie').getContext('2d');
    const s = reportData.sentiments;
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Negativo', 'Neutro', 'Positivo'],
        datasets: [{
          data: [s.negativo, s.neutro, s.positivo],
          backgroundColor: ['#ff6b6b', '#8892b0', '#00d4aa'],
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'bottom', labels: { color: '#e8eaf6', padding: 15, font: { size: 12 } } },
          datalabels: {
            color: '#fff',
            font: { weight: 'bold', size: 16 },
            formatter: (value, ctx) => {
              const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
              return ((value / total) * 100).toFixed(1) + '%';
            }
          }
        }
      }
    });
  }

  function renderRiskRadar() {
    const ctx = document.getElementById('risk-radar').getContext('2d');
    const total = reportData.total_comments;
    const neg = reportData.sentiments.negativo;
    const pos = reportData.sentiments.positivo;
    const negRatio = neg / total;
    const ratio = pos > 0 ? neg / pos : 999;
    
    const riskScores = {
      rejeicao: Math.min(negRatio * 100, 100),
      crise: Math.min(negRatio * 120, 100),
      eleitoral: Math.min(ratio * 4, 100),
      imagem: Math.min(negRatio * 90, 100),
      estadual: Math.min(negRatio * 85, 100)
    };
    
    const avgRisk = Object.values(riskScores).reduce((a, b) => a + b, 0) / 5;
    
    new Chart(ctx, {
      type: 'radar',
      data: {
        labels: ['Rejei√ß√£o Popular', 'Crise Tribut√°ria', 'Risco Eleitoral', 'Imagem P√∫blica', 'Viabilidade Estadual'],
        datasets: [{
          label: '√çndice de Risco',
          data: Object.values(riskScores),
          backgroundColor: 'rgba(255, 107, 107, 0.2)',
          borderColor: '#ff6b6b',
          borderWidth: 3,
          pointBackgroundColor: '#ff6b6b',
          pointBorderColor: '#fff',
          pointRadius: 5
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          r: {
            beginAtZero: true,
            max: 100,
            ticks: { 
              color: '#8892b0', 
              backdropColor: 'transparent', 
              stepSize: 20,
              callback: (value) => value + '/100'
            },
            grid: { color: '#2e3350' },
            pointLabels: { color: '#e8eaf6', font: { size: 11 } }
          }
        },
        plugins: { legend: { display: false } }
      }
    });
    
    const riskClass = avgRisk > 75 ? 'risk-critical' : avgRisk > 50 ? 'risk-high' : 'risk-medium';
    const riskLabel = avgRisk > 75 ? 'CR√çTICO' : avgRisk > 50 ? 'ALTO' : 'M√âDIO';
    
    document.getElementById('risk-assessment').innerHTML = `
      <div style="text-align: center; padding: 15px; background: rgba(255,107,107,0.1); border-radius: 8px;">
        <strong style="color: var(--text-muted);">√çndice Global de Risco:</strong><br>
        <span class="risk-indicator ${riskClass}" style="font-size: 1.5rem; margin-top: 8px; display: inline-block;">
          ${avgRisk.toFixed(1)}/100 - ${riskLabel}
        </span>
      </div>
    `;
  }

  function renderStrategicInsights() {
    const total = reportData.total_comments;
    const s = reportData.sentiments;
    const negPct = ((s.negativo / total) * 100).toFixed(1);
    const posPct = ((s.positivo / total) * 100).toFixed(1);
    const ratio = s.positivo > 0 ? (s.negativo / s.positivo).toFixed(1) : '999';
    const lixo = reportData.themes.Lixo || 0;
    const lixoPct = ((lixo / total) * 100).toFixed(1);
    
    const topLocs = Object.entries(reportData.locations)
      .filter(([n]) => n !== 'N√£o especificado')
      .sort((a, b) => b[1] - a[1])
      .slice(0, 3)
      .map(l => l[0])
      .join(', ');
    
    const hourly = reportData.hourly_distribution || Array(24).fill(0);
    const peakHour = hourly.indexOf(Math.max(...hourly));
    
    const insights = [
      `<strong>Crise Confirmada:</strong> ${negPct}% de rejei√ß√£o (${s.negativo.toLocaleString()} coment√°rios) contra apenas ${posPct}% positivo (${s.positivo} coment√°rios) - Ratio de <strong>${ratio}:1</strong>`,
      
      `<strong>Volume Massivo:</strong> ${total.toLocaleString('pt-BR')} coment√°rios analisados confirmam insatisfa√ß√£o generalizada e mobiliza√ß√£o popular contra a Taxa do Lixo`,
      
      `<strong>Tema Dominante:</strong> Lixo (${lixo} men√ß√µes / ${lixoPct}% do total) √© o principal foco de insatisfa√ß√£o - 162% acima do esperado`,
      
      `<strong>Bairros Cr√≠ticos:</strong> ${topLocs} concentram maior volume de reclama√ß√µes - Necess√°rio priorizar audi√™ncias nessas regi√µes`,
      
      `<strong>Padr√£o Temporal:</strong> Pico de engajamento √†s ${peakHour}h indica audi√™ncia noturna - Melhor hor√°rio para comunica√ß√£o oficial: <strong>10h-11h</strong> (manh√£)`,
      
      `<strong>Compara√ß√£o Populacional:</strong> Considerando popula√ß√£o de Cabo Frio (~230mil hab), o volume representa mobiliza√ß√£o significativa da base eleitoral`,
      
      `<strong>A√ß√£o Urgente (7 dias):</strong> Audi√™ncias p√∫blicas descentralizadas + V√≠deo do prefeito com transpar√™ncia total sobre destino dos recursos + Suspens√£o de multas`,
      
      `<strong>M√©dio Prazo (30 dias):</strong> Portal "Para Onde Vai Meu Dinheiro" (transpar√™ncia em tempo real) + Programa "Cabo Frio Limpa" com descontos para quem recicla`,
      
      `<strong>Risco Eleitoral 2028:</strong> Sem a√ß√£o imediata e efetiva, viabilidade de reelei√ß√£o fica severamente comprometida. Tema pode definir elei√ß√£o municipal`,
      
      `<strong>Ambi√ß√£o Estadual 2030:</strong> Capital pol√≠tico necess√°rio para candidatura ao governo estadual est√° sendo corro√≠do pela crise local. Revers√£o urgente necess√°ria`
    ];
    
    document.getElementById('strategic-insights').innerHTML = insights.map((i, idx) => 
      `<div class="insight-box"><p><strong style="color: var(--accent2);">${idx + 1}.</strong> ${i}</p></div>`
    ).join('');
  }

  function renderBenchmarking() {
    const cases = [
      { 
        city: 'Curitiba/PR', 
        action: 'Programa "Lixo que n√£o √© Lixo"', 
        details: 'Troca de recicl√°veis por vale-transporte + Educa√ß√£o ambiental massiva nas escolas', 
        result: 'Taxa aceita pela popula√ß√£o, cidade se tornou refer√™ncia nacional em sustentibilidade', 
        success: true,
        year: '1989'
      },
      { 
        city: 'Niter√≥i/RJ', 
        action: 'Taxa Progressiva + Portal de Transpar√™ncia', 
        details: 'Desconto de at√© 40% para quem separa lixo recicl√°vel + Site mostrando arrecada√ß√£o vs investimento em tempo real', 
        result: 'Redu√ß√£o de 30% nas reclama√ß√µes em 6 meses, ades√£o volunt√°ria √† coleta seletiva', 
        success: true,
        year: '2019'
      },
      { 
        city: 'Vit√≥ria/ES', 
        action: 'App de Den√∫ncia + Resposta em 48h', 
        details: 'Aplicativo para reportar problemas de coleta com prazo m√°ximo de resposta da prefeitura', 
        result: 'Satisfa√ß√£o subiu de 42% para 71% em 1 ano', 
        success: true,
        year: '2020'
      },
      { 
        city: 'Porto Alegre/RS', 
        action: 'Taxa Progressiva por Renda', 
        details: 'Valor baseado no IPTU (fam√≠lias de baixa renda pagam menos)', 
        result: 'Percep√ß√£o de justi√ßa social, aceita√ß√£o de 68% da popula√ß√£o', 
        success: true,
        year: '2018'
      },
      { 
        city: 'Florian√≥polis/SC', 
        action: 'Desconto por Compostagem Dom√©stica', 
        details: 'At√© 50% de desconto para quem faz compostagem em casa (verifica√ß√£o via foto)', 
        result: 'Redu√ß√£o de 18% no volume de lixo org√¢nico na cidade', 
        success: true,
        year: '2021'
      },
      { 
        city: 'S√£o Paulo/SP', 
        action: 'Implementa√ß√£o sem Di√°logo Pr√©vio', 
        details: 'Taxa criada sem consulta popular, comunica√ß√£o apenas t√©cnica', 
        result: 'Revoga√ß√£o ap√≥s 6 meses devido press√£o popular e judicial', 
        success: false,
        year: '2012'
      },
      { 
        city: 'Belo Horizonte/MG', 
        action: 'Taxa sem Contrapartida Vis√≠vel', 
        details: 'Cobran√ßa iniciada antes de melhorias na coleta', 
        result: 'Suspens√£o judicial, prefeitura condenada a devolver valores', 
        success: false,
        year: '2015'
      },
      { 
        city: 'Salvador/BA', 
        action: 'Valores Muito Acima do Esperado', 
        details: 'Taxa superior ao IPTU de muitos im√≥veis', 
        result: 'Protestos massivos, taxa suspensa ap√≥s 3 meses', 
        success: false,
        year: '2017'
      }
    ];
    
    document.getElementById('benchmarking-section').innerHTML = cases.map(c => `
      <div class="benchmarking-card ${c.success ? 'success' : 'failure'}">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
          <strong style="color: ${c.success ? 'var(--positive)' : 'var(--negative)'}; font-size: 1rem;">
            ${c.success ? '‚úÖ' : '‚ùå'} ${c.city}
          </strong>
          <span style="background: rgba(108,99,255,0.2); padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; color: var(--accent);">
            ${c.year}
          </span>
        </div>
        <div style="margin: 8px 0;">
          <strong style="color: var(--text);">A√ß√£o:</strong> ${c.action}
        </div>
        <div style="margin: 8px 0; font-size: 0.85rem; color: var(--text-muted);">
          ${c.details}
        </div>
        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border);">
          <strong style="color: ${c.success ? 'var(--positive)' : 'var(--negative)'};">
            ${c.success ? 'Resultado Positivo:' : 'Resultado Negativo:'}
          </strong> ${c.result}
        </div>
      </div>
    `).join('');
  }

  function renderSaguiSuggestions() {
    const suggestions = [
      {
        phase: 'üö® Urgente (7 dias)',
        actions: [
          '<strong>Audi√™ncias P√∫blicas Descentralizadas:</strong> Come√ßar por Per√≥, Tamoios e Centro (bairros mais cr√≠ticos). Formato: roda de conversa, n√£o palestra',
          '<strong>V√≠deo do Prefeito:</strong> 3-5 minutos explicando PORQU√ä da taxa, PARA ONDE vai o dinheiro, QUANDO ter√£o melhorias vis√≠veis. Tom humano, n√£o pol√≠tico',
          '<strong>Suspens√£o de Multas por 60 dias:</strong> Dar tempo para popula√ß√£o entender antes de penalizar. Anunciar publicamente como gesto de boa-f√©'
        ]
      },
      {
        phase: '‚ö° Curto Prazo (30 dias)',
        actions: [
          '<strong>Portal "Para Onde Vai Meu Dinheiro":</strong> Site/app mostrando arrecada√ß√£o vs investimento em tempo real. Atualiza√ß√£o semanal com fotos das melhorias',
          '<strong>Programa "Cabo Frio Limpa":</strong> Troca de recicl√°veis por desconto na taxa (modelo Curitiba). Parceria com cooperativas locais',
          '<strong>WhatsApp Oficial "Tira-D√∫vidas":</strong> Canal direto para esclarecer d√∫vidas sobre valores. Resposta garantida em at√© 2 horas √∫teis',
          '<strong>Primeira Melhoria Vis√≠vel:</strong> Escolher 3 bairros cr√≠ticos e fazer melhoria concreta na coleta em 30 dias. Divulgar massivamente "resultado da taxa"'
        ]
      },
      {
        phase: 'üéØ M√©dio Prazo (90 dias)',
        actions: [
          '<strong>Taxa Progressiva:</strong> Estudar modelo de desconto para quem separa lixo (reduz custo da prefeitura, incentiva popula√ß√£o)',
          '<strong>Campanha "Cabo Frio + Limpa":</strong> Educa√ß√£o ambiental nas escolas + competi√ß√£o entre bairros (mais sustent√°vel ganha melhorias)',
          '<strong>Comparativo Transparente:</strong> Mostrar Cabo Frio vs outras cidades (quanto pagam, qual servi√ßo recebem). Provar que n√£o est√° fora da realidade',
          '<strong>Conselho Municipal do Lixo:</strong> Incluir representantes de cada bairro para fiscalizar aplica√ß√£o dos recursos. Reuni√µes p√∫blicas mensais'
        ]
      }
    ];
    
    document.getElementById('sagui-suggestions').innerHTML = suggestions.map(s => `
      <div style="background: var(--surface2); padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid var(--accent);">
        <h4 style="color: var(--accent2); margin-bottom: 15px; font-size: 1rem;">${s.phase}</h4>
        <ol style="line-height: 2; padding-left: 20px; color: var(--text);">
          ${s.actions.map(a => `<li style="margin-bottom: 12px;">${a}</li>`).join('')}
        </ol>
      </div>
    `).join('');
  }

  function renderDetailedComments() {
    const detailed = allComments.filter(c => 
      c.locations.some(l => l !== 'N√£o especificado') && c.themes.length > 0 && c.text.length > 50
    ).sort((a, b) => (parseInt(b.likes||0) + parseInt(b.replies||0)) - (parseInt(a.likes||0) + parseInt(a.replies||0)))
    .slice(0, 20);
    
    document.getElementById('detailed-comments').innerHTML = detailed.map(c => {
      const initial = c.username.charAt(0).toUpperCase();
      const sentClass = `badge-${c.sentiment === 'negativo' ? 'neg' : c.sentiment === 'positivo' ? 'pos' : 'neu'}`;
      return `
        <div class="comment-card">
          <div class="comment-header">
            <div style="display: flex; align-items: center; gap: 10px;">
              <div class="comment-avatar">${initial}</div>
              <div>
                <div class="comment-user">@${c.username}</div>
                <div style="font-size: 0.7rem; color: var(--text-muted);">${new Date(c.timestamp || Date.now()).toLocaleDateString('pt-BR')}</div>
              </div>
            </div>
            <div style="font-size: 0.75rem; color: var(--text-muted);">‚ù§Ô∏è ${c.likes || 0} ‚Ä¢ üí¨ ${c.replies || 0}</div>
          </div>
          <div class="comment-text">${c.text}</div>
          <div class="comment-footer">
            <span class="badge ${sentClass}">${c.sentiment}</span>
            ${c.locations.filter(l => l !== 'N√£o especificado').map(loc => `<span class="badge badge-location">üìç ${loc}</span>`).join('')}
            ${c.themes.slice(0, 2).map(t => `<span class="badge badge-theme">${themeIcons[t] || 'üìå'} ${t}</span>`).join('')}
          </div>
        </div>
      `;
    }).join('');
  }

  function renderWordCloudComments() {
    const wordCounts = {};
    allComments.forEach(c => {
      c.text.toLowerCase().replace(/[^\w√Ä-√ø\s]/g, ' ').split(/\s+/)
        .filter(w => w.length > 3 && !['para', 'pela', 'pelo', 'com', 'uma', 'isso', 'esse', 'esta', 'est√°', 'mais', 'muito', 'aqui', 'cabo', 'frio'].includes(w))
        .forEach(w => { wordCounts[w] = (wordCounts[w] || 0) + 1; });
    });
    
    const topWords = Object.entries(wordCounts).sort((a, b) => b[1] - a[1]).slice(0, 50);
    const maxCount = Math.max(...topWords.map(w => w[1]));
    const colors = ['#6c63ff', '#00d4aa', '#ff6b6b', '#ffd166', '#c77dff', '#a8dadc'];
    
    document.getElementById('wordcloud-comments').innerHTML = topWords.map(([word, count], i) => {
      const size = 0.7 + (count / maxCount) * 1.5;
      const color = colors[i % colors.length];
      return `<span class="word-tag" style="font-size: ${size}rem; color: ${color}; background: ${color}22; border: 1px solid ${color}44;" onclick="searchWord('${word}')">${word} (${count})</span>`;
    }).join('');
  }

  function searchWord(word) {
    document.getElementById('search-all-comments').value = word;
    searchAllComments();
    document.getElementById('all-comments-list').scrollIntoView({ behavior: 'smooth' });
  }

  function renderAllComments() {
    displayComments(allComments);
  }

  function displayComments(comments) {
    document.getElementById('all-comments-list').innerHTML = comments.slice(0, 100).map(c => {
      const initial = c.username.charAt(0).toUpperCase();
      const sentClass = `badge-${c.sentiment === 'negativo' ? 'neg' : c.sentiment === 'positivo' ? 'pos' : 'neu'}`;
      return `
        <div class="comment-card">
          <div class="comment-header">
            <div style="display: flex; align-items: center; gap: 10px;">
              <div class="comment-avatar">${initial}</div>
              <div class="comment-user">@${c.username}</div>
            </div>
            <span class="badge ${sentClass}">${c.sentiment}</span>
          </div>
          <div class="comment-text">${c.text}</div>
          <div class="comment-footer">
            ${c.locations.filter(l => l !== 'N√£o especificado').map(loc => `<span class="badge badge-location">üìç ${loc}</span>`).join('')}
            <span style="font-size: 0.75rem; color: var(--text-muted); margin-left: auto;">‚ù§Ô∏è ${c.likes || 0} ‚Ä¢ üí¨ ${c.replies || 0}</span>
          </div>
        </div>
      `;
    }).join('');
  }

  function filterCommentsBySentiment(sentiment) {
    currentCommentFilter = sentiment;
    document.querySelectorAll('.filter-tab').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    let filtered = sentiment !== 'all' ? allComments.filter(c => c.sentiment === sentiment) : allComments;
    displayComments(filtered);
  }

  function searchAllComments() {
    const searchTerm = document.getElementById('search-all-comments').value.toLowerCase();
    let filtered = currentCommentFilter !== 'all' ? allComments.filter(c => c.sentiment === currentCommentFilter) : allComments;
    if (searchTerm) filtered = filtered.filter(c => c.text.toLowerCase().includes(searchTerm));
    displayComments(filtered);
  }

  function renderCriticalMonitoring() {
    const criticalKeywords = {
      'Mil√≠cia/Miliciano': ['milicia', 'miliciano', 'milicianos', 'mil√≠cia'],
      'Governo do Estado': ['governo do estado', 'governador', 'claudio castro', 'castro']
    };
    
    let html = '';
    for (const [category, keywords] of Object.entries(criticalKeywords)) {
      const matching = allComments.filter(c => keywords.some(k => c.text.toLowerCase().includes(k)));
      if (matching.length > 0) {
        html += `
          <div class="alert-box">
            <div class="alert-title">üö® ${category}</div>
            <div style="color: var(--text); margin-bottom: 12px;"><strong>${matching.length} men√ß√µes detectadas</strong></div>
            <div style="max-height: 300px; overflow-y: auto;">
              ${matching.slice(0, 5).map(c => `
                <div style="background: var(--surface); padding: 10px; margin-bottom: 8px; border-radius: 6px; font-size: 0.8rem;">
                  <strong>@${c.username}:</strong> ${c.text.substring(0, 150)}${c.text.length > 150 ? '...' : ''}
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }
    }
    
    if (html === '') html = '<div class="chart-card"><p style="text-align: center; color: var(--text-muted); padding: 30px;">‚úì Nenhuma palavra cr√≠tica detectada no monitoramento</p></div>';
    document.getElementById('critical-monitoring').innerHTML = html;
  }

  function renderGabrielaAlert() {
    const gabriela = reportData.gabriela_monitoring || { total_mentions: 0 };
    document.getElementById('gabriela-count').textContent = gabriela.total_mentions;
    if (gabriela.total_mentions > 0) {
      document.getElementById('gabriela-status').innerHTML = `
        <strong style="color: var(--negative);">‚ö†Ô∏è Alerta:</strong> ${gabriela.total_mentions} men√ß√£o(√µes) detectada(s) - Monitoramento ativo
      `;
      document.getElementById('gabriela-status').style.background = 'rgba(255,107,107,0.1)';
      document.getElementById('gabriela-status').style.borderLeftColor = 'var(--negative)';
    }
  }

  function renderHeatmap() {
    const locations = Object.entries(reportData.locations)
      .filter(([n]) => n !== 'N√£o especificado')
      .sort((a, b) => b[1] - a[1]);
    
    const maxCount = Math.max(...locations.map(l => l[1]));
    const container = document.getElementById('heatmap-container');
    container.innerHTML = '';
    
    // Posi√ß√µes aproximadas dos bairros no mapa de Cabo Frio
    const positions = {
      'Per√≥': { left: '15%', top: '20%' },
      'Tamoios': { left: '75%', top: '15%' },
      'Centro': { left: '50%', top: '50%' },
      'Braga': { left: '60%', top: '55%' },
      'Passagem': { left: '45%', top: '40%' },
      'Praia do Forte': { left: '40%', top: '30%' },
      'Unamar': { left: '85%', top: '25%' },
      'S√£o Crist√≥v√£o': { left: '55%', top: '65%' },
      'Guarani': { left: '70%', top: '70%' },
      'Jacar√©': { left: '65%', top: '45%' },
      'Ogiva': { left: '35%', top: '60%' },
      'Palmeiras': { left: '50%', top: '70%' },
      'Monte Alto': { left: '30%', top: '35%' }
    };
    
    locations.forEach(([name, count]) => {
      const pos = positions[name] || { left: `${Math.random() * 80 + 10}%`, top: `${Math.random() * 80 + 10}%` };
      const size = 20 + (count / maxCount) * 50;
      const color = count > 10 ? '#ff6b6b' : count > 5 ? '#ffd166' : '#00d4aa';
      
      const point = document.createElement('div');
      point.className = 'heatmap-point';
      point.style.width = size + 'px';
      point.style.height = size + 'px';
      point.style.left = pos.left;
      point.style.top = pos.top;
      point.style.backgroundColor = color;
      point.style.color = color;
      point.title = `${name}: ${count} men√ß√µes`;
      point.innerHTML = count;
      point.onclick = () => alert(`${name}\n${count} men√ß√µes detectadas\n\nClique em "Localiza√ß√£o" > "Principais Cobran√ßas" para ver detalhes`);
      
      container.appendChild(point);
    });
  }

  function renderLocationChartDetail() {
    const ctx = document.getElementById('location-chart-detail').getContext('2d');
    const locs = Object.entries(reportData.locations)
      .filter(([n]) => n !== 'N√£o especificado')
      .sort((a, b) => b[1] - a[1]);
    
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: locs.map(l => l[0]),
        datasets: [{
          label: 'Men√ß√µes',
          data: locs.map(l => l[1]),
          backgroundColor: 'rgba(0, 212, 170, 0.8)',
          borderColor: '#00d4aa',
          borderWidth: 1,
          borderRadius: 6
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          x: { grid: { color: '#2e3350' }, ticks: { color: '#8892b0', maxRotation: 45, minRotation: 45 } },
          y: { grid: { display: false }, ticks: { color: '#e8eaf6' } }
        }
      }
    });
  }

  function renderLocationBarsDetail() {
    const locs = Object.entries(reportData.locations)
      .filter(([n]) => n !== 'N√£o especificado')
      .sort((a, b) => b[1] - a[1]);
    
    const maxCount = Math.max(...locs.map(l => l[1]));
    document.getElementById('location-bars-detail').innerHTML = locs.map(([name, count]) => `
      <div class="loc-row">
        <div class="loc-name">${name}</div>
        <div class="loc-bar-wrap">
          <div class="loc-bar" style="width: ${(count / maxCount) * 100}%"></div>
        </div>
        <div class="loc-count">${count}</div>
      </div>
    `).join('');
  }

  function renderDemandsByLocation() {
    const locDemands = {};
    allComments.forEach(c => {
      c.locations.forEach(loc => {
        if (loc !== 'N√£o especificado') {
          if (!locDemands[loc]) locDemands[loc] = [];
          locDemands[loc].push(c);
        }
      });
    });
    
    const sorted = Object.entries(locDemands).sort((a, b) => b[1].length - a[1].length).slice(0, 13);
    document.getElementById('demands-by-location').innerHTML = sorted.map(([loc, comments]) => {
      const top = comments.sort((a, b) => (parseInt(b.likes||0) + parseInt(b.replies||0)) - (parseInt(a.likes||0) + parseInt(a.replies||0))).slice(0, 5);
      return `
        <div class="theme-detail">
          <h4>üìç ${loc} <span style="color: var(--text-muted); font-size: 0.8rem; font-weight: normal;">(${comments.length} men√ß√µes)</span></h4>
          <ul class="demand-list">
            ${top.map((c, i) => `
              <li class="demand-item">
                <strong>#${i + 1}</strong>
                ${c.text.substring(0, 200)}${c.text.length > 200 ? '...' : ''}
                <div style="margin-top: 6px; font-size: 0.75rem; color: var(--text-muted);">@${c.username} ‚Ä¢ ‚ù§Ô∏è ${c.likes || 0} ‚Ä¢ üí¨ ${c.replies || 0}</div>
              </li>
            `).join('')}
          </ul>
        </div>
      `;
    }).join('');
  }

  function renderThemesChartDetail() {
    const ctx = document.getElementById('themes-chart-detail').getContext('2d');
    const themes = Object.entries(reportData.themes).filter(([n]) => n !== 'Outros').sort((a, b) => b[1] - a[1]);
    
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: themes.map(t => t[0]),
        datasets: [{
          label: 'Men√ß√µes',
          data: themes.map(t => t[1]),
          backgroundColor: 'rgba(255, 209, 102, 0.8)',
          borderColor: '#ffd166',
          borderWidth: 1,
          borderRadius: 6
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
          x: { grid: { color: '#2e3350' }, ticks: { color: '#8892b0', maxRotation: 45, minRotation: 45 } },
          y: { grid: { display: false }, ticks: { color: '#e8eaf6' } }
        }
      }
    });
  }

  function renderThemeFolders() {
    const mainThemes = ['Saneamento', 'Estradas', 'Ordenamento', 'Sa√∫de', 'Seguran√ßa', 'Ilumina√ß√£o', 'Lixo', 
                        'Moradores de rua', 'Mobilidade', 'Esporte/lazer', 'Educa√ß√£o', 'Turismo', 'Pediatria', 'Canil municipal'];
    
    document.getElementById('theme-folders').innerHTML = mainThemes.map(theme => {
      const count = reportData.themes[theme] || 0;
      const icon = themeIcons[theme] || 'üìå';
      return `
        <div class="theme-folder">
          <div class="theme-icon">${icon}</div>
          <div class="theme-count">${count}</div>
          <div class="theme-name">${theme}</div>
        </div>
      `;
    }).join('');
  }

  function renderThemeDetails() {
    const themeComments = {};
    allComments.forEach(c => {
      c.themes.forEach(t => {
        if (!themeComments[t]) themeComments[t] = [];
        themeComments[t].push(c);
      });
    });
    
    const sorted = Object.entries(themeComments).filter(([t]) => t !== 'Outros').sort((a, b) => b[1].length - a[1].length);
    
    document.getElementById('theme-details').innerHTML = sorted.map(([theme, comments]) => {
      const top = comments.sort((a, b) => (parseInt(b.likes||0) + parseInt(b.replies||0)) - (parseInt(a.likes||0) + parseInt(a.replies||0))).slice(0, 10);
      const icon = themeIcons[theme] || 'üìå';
      
      const keywords = [...new Set(comments.flatMap(c => 
        c.text.toLowerCase().split(/\s+/).filter(w => w.length > 4)
      ))].slice(0, 6);
      
      const negPct = ((comments.filter(c => c.sentiment === 'negativo').length / comments.length) * 100).toFixed(0);
      const topLoc = [...new Set(comments.flatMap(c => c.locations).filter(l => l !== 'N√£o especificado'))][0] || 'N√£o especificado';
      
      return `
        <div class="theme-detail">
          <div style="text-align: center; margin-bottom: 30px;">
            <h3 style="font-size: 24px; margin-bottom: 10px;">${icon} ${theme.toUpperCase()}</h3>
            <p style="color: var(--text-muted); font-size: 14px;">${comments.length} men√ß√µes identificadas (${((comments.length/reportData.total_comments)*100).toFixed(1)}% do total)</p>
          </div>
          
          <div style="text-align: center; margin: 30px 0;">
            ${keywords.map(k => `<div class="theme-button">${k.toUpperCase()}</div>`).join('')}
          </div>
          
          <div class="summary-grid">
            <div class="summary-card">
              <div class="summary-label">Principal Demanda</div>
              <div class="summary-value">${theme === 'Lixo' ? 'Redu√ß√£o da Taxa' : 'Melhoria do Servi√ßo'}</div>
            </div>
            <div class="summary-card">
              <div class="summary-label">Sentimento Geral</div>
              <div class="summary-value" style="color: ${negPct > 50 ? 'var(--negative)' : 'var(--positive)'}">üî¥ ${negPct}% Negativo</div>
            </div>
            <div class="summary-card">
              <div class="summary-label">Regi√£o Mais Afetada</div>
              <div class="summary-value">${topLoc}</div>
            </div>
            <div class="summary-card">
              <div class="summary-label">Prioridade</div>
              <div class="summary-value" style="color: ${negPct > 70 ? 'var(--negative)' : 'var(--accent4)'}">‚ö° ${negPct > 70 ? 'URGENTE' : 'ALTA'}</div>
            </div>
          </div>
          
          <div style="margin-top: 20px; padding: 15px; background: rgba(108,99,255,0.1); border-left: 3px solid var(--accent); border-radius: 6px;">
            <strong style="color: var(--accent);">üêµ Insight SAGUI.ia:</strong><br>
            <span style="color: var(--text);">
              ${theme === 'Lixo' ? 
                `Com ${comments.length} men√ß√µes (${((comments.length/reportData.total_comments)*100).toFixed(1)}% do total), Taxa do Lixo √© o tema mais sens√≠vel. Popula√ß√£o precisa entender o PORQU√ä antes de aceitar valores. Recomenda-se: (1) Transpar√™ncia total sobre destino, (2) Comparativo com outras cidades, (3) Primeiras melhorias vis√≠veis em 30 dias` : 
                `Alta concentra√ß√£o de men√ß√µes negativas (${negPct}%). Requer a√ß√£o imediata nas regi√µes mais afetadas, come√ßando por ${topLoc}.`}
            </span>
          </div>
          
          <h4 style="margin-top: 30px; margin-bottom: 15px;">üîù Top ${Math.min(10, top.length)} Demandas (por Engajamento)</h4>
          <ul class="demand-list">
            ${top.map((c, i) => `
              <li class="demand-item">
                <strong>#${i + 1}</strong>
                ${c.text.substring(0, 180)}${c.text.length > 180 ? '...' : ''}
                ${c.locations.filter(l => l !== 'N√£o especificado').length > 0 ? 
                  `<br><small style="color: var(--accent2);">üìç ${c.locations.filter(l => l !== 'N√£o especificado').join(', ')}</small>` : ''}
                <div style="margin-top: 6px; font-size: 0.75rem; color: var(--text-muted);">@${c.username} ‚Ä¢ ‚ù§Ô∏è ${c.likes || 0} ‚Ä¢ üí¨ ${c.replies || 0}</div>
              </li>
            `).join('')}
          </ul>
        </div>
      `;
    }).join('');
  }

  loadData();
</script>

</body>
</html>
